<html lang="en">
    <head>
        <title>UEA Assassins: Duels</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <style>
            .center {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 50%;
                width: 50%;
                margin: auto;
                padding: 0;

                border-radius: 15px;
                border: 2px solid white;
                background-color: white;
            }

            .center-wrapper {
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;

            }

            .red {
                background-color: red;
            }

            .green {
                background-color: lawngreen;
            }

        </style>
    </head>
    <body>
        <script src="/public/js/header.js"></script>

        <div class="center-wrapper">
            <div class="center" id="background">
                <p id="output-text">Just Loading...</p>
            </div>
        </div>


        <script>
            const backgroundDiv = document.getElementById("background");
            const textEl = document.getElementById("output-text");

            const params = new URLSearchParams(window.location.search);
            const user_id = params.get('id');
            const is_tournament = params.get('tournament') === true;

            function updateStatus() {
                let pointer = 'duels'

                if (is_tournament) {
                    pointer = 'duels_t'
                }

                fetch(`/game/${pointer}/status?id=${user_id}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.error) {
                            if (backgroundDiv.classList.contains("green")) {
                                backgroundDiv.classList.remove("green");
                            }
                            backgroundDiv.classList.add("red");
                            textEl.textContent = data.error
                            return;
                        }

                        if (data.is_playing) {
                            if (backgroundDiv.classList.contains("red")) {
                                backgroundDiv.classList.remove("red");
                            }
                            backgroundDiv.classList.add("green");
                            textEl.textContent = 'Its Your Turn!'
                        } else {

                            if (backgroundDiv.classList.contains("green")) {
                                backgroundDiv.classList.remove("green");
                            }
                            backgroundDiv.classList.add("red");
                            textEl.textContent = 'Its Not Your Turn'
                        }
                    })
            }

            setInterval(updateStatus, 1000);

        </script>
    </body>
</html>