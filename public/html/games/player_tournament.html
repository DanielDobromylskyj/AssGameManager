<html lang="en">
    <head>
        <title>UEA Assassins: Duels</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <style>
            .center {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 50%;
                width: 50%;
                margin: auto;
                padding: 0;

                border-radius: 15px;
                border: 2px solid white;
                background-color: white;
            }

            .center-wrapper {
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;

            }

            .red {
                background-color: red;
            }

            .green {
                background-color: lawngreen;
            }

            .orange {
                background-color: orange;
            }

        </style>
    </head>
    <body>
        <script src="/public/js/header.js"></script>

        <div class="center-wrapper">
            <div class="center" id="background">
                <p id="output-text">Just Loading...</p>
            </div>
            <button id="rejoin-btn" hidden>Attempt Rejoin</button>
        </div>


        <script>
            const backgroundDiv = document.getElementById("background");
            const textEl = document.getElementById("output-text");
            const rejoinEl = document.getElementById("rejoin-btn");

            function rejoin() {
                let href = window.location.href;

                if (!href.endsWith("/")) {
                    href += "/"
                }

                window.location.href = href + "join";
            }

            rejoinEl.addEventListener("click", rejoin)

            function updateStatus() {
                fetch(`/game/tournament/status`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.error) {
                            if (backgroundDiv.classList.contains("green")) {
                                backgroundDiv.classList.remove("green");
                            }
                            if (backgroundDiv.classList.contains("red")) {
                                backgroundDiv.classList.remove("red");
                            }

                            backgroundDiv.classList.add("orange");
                            textEl.textContent = data.error

                            if (data.error === "You are not a part of this game") {
                                rejoinEl.hidden = false;
                            }

                            return;
                        }

                        if (data.is_playing) {
                            if (backgroundDiv.classList.contains("red")) {
                                backgroundDiv.classList.remove("red");
                            }
                            if (backgroundDiv.classList.contains("orange")) {
                                backgroundDiv.classList.remove("orange");
                            }
                            backgroundDiv.classList.add("green");
                            textEl.textContent = 'Its Your Turn!'
                        } else {

                            if (backgroundDiv.classList.contains("green")) {
                                backgroundDiv.classList.remove("green");
                            }
                            if (backgroundDiv.classList.contains("orange")) {
                                backgroundDiv.classList.remove("orange");
                            }
                            backgroundDiv.classList.add("red");
                            textEl.textContent = 'Its Not Your Turn'
                        }
                    })
            }

            setInterval(updateStatus, 1000);

        </script>
    </body>
</html>